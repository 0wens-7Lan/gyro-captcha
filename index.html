<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>æ‘‡ä¸€æ‘‡éªŒè¯ç </title>
    <style>
        /* 1. å…¨å±€æ ·å¼å’ŒèƒŒæ™¯ */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            padding-top: 50px; /* ä¸ºé¡¶éƒ¨ç•™å‡ºç©ºé—´ */
        }

        /* å¤´éƒ¨æ ‡é¢˜ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            background-color: white;
            z-index: 10;
            border-bottom: 1px solid #eee;
        }

        /* éªŒè¯åŒºåŸŸå¡ç‰‡ */
        .verification-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 400px;
            padding: 20px 15px;
            margin-top: 10px;
            box-sizing: border-box;
        }

        /* 2. æç¤ºä¿¡æ¯ */
        .prompt {
            text-align: center;
            padding-bottom: 20px;
        }

        .prompt h3 {
            color: #1a73e8;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .prompt p {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        /* 3. ç›®æ ‡ä½ç½®åŒºåŸŸ */
        .target-area {
            background-color: #ff5773;
            color: white;
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .target-area .label {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .target-area .value {
            font-size: 32px;
            font-weight: bold;
        }

        .target-tip {
            font-size: 12px;
            margin-top: 10px;
            opacity: 0.8;
        }

        /* ç›®æ ‡ä½ç½®å®šä½ç‚¹ (ç™½è‰²å°åœ†ç‚¹) */
        .target-marker {
            position: absolute;
            bottom: -5px;
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            transform: translateX(-50%);
            transition: left 0.5s ease;
        }

        /* 4. æ»‘åŠ¨æ¡åŒºåŸŸ */
        .slider-container {
            position: relative;
            height: 30px;
            margin-bottom: 20px;
        }

        .slider-track {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            transform: translateY(-50%);
        }

        /* å¯ç§»åŠ¨çš„å°çƒ/æ»‘å— */
        .slider-handle {
            position: absolute;
            top: 50%;
            width: 25px;
            height: 25px;
            background-color: #4a90e2;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
        }
        
        /* å·¦å³ç®­å¤´å›¾æ ‡ */
        .arrow-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 20px;
            font-weight: bold;
        }

        .left-arrow {
            left: -30px;
        }

        .right-arrow {
            right: -30px;
        }

        /* 5. åˆ»åº¦å°º */
        .scale-ruler {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 5px;
            color: #999;
            font-size: 10px;
        }

        /* 6. å½“å‰ä½ç½®æ˜¾ç¤ºæ¡† */
        .current-position-box {
            border: 1px solid #ddd;
            background-color: #f0f0f0;
            border-radius: 6px;
            padding: 10px;
            margin-top: 30px;
            text-align: center;
            position: relative;
            font-size: 14px;
            color: #333;
        }

        .current-position-box .label {
            position: absolute;
            bottom: 100%;
            left: 10px;
            font-size: 12px;
            color: #666;
            padding-bottom: 5px;
        }

        .current-position-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a73e8;
        }

        /* éªŒè¯æˆåŠŸ/å¤±è´¥æç¤º */
        .message {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            min-height: 20px;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }
        
        /* æƒé™æŒ‰é’®æ ·å¼ */
        #permissionButton {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        #permissionButton:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* åº•éƒ¨å¯¼èˆªæ æ¨¡æ‹Ÿ */
        .nav-bar {
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            height: 50px; 
            background: #fff; 
            box-shadow: 0 -1px 3px rgba(0,0,0,0.1); 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            padding-bottom: env(safe-area-inset-bottom, 5px);
            z-index: 10;
        }
        .nav-bar span {
            font-size: 24px;
            color: #555;
            padding: 0 10px;
        }
    </style>
</head>
<body>

    <div class="header">ç¬¬ä¸€å…³ï¼šæ‘‡ä¸€æ‘‡éªŒè¯ç </div>

    <div class="verification-card">
        
        <button id="permissionButton">ç‚¹å‡»æˆæƒæ‘‡æ™ƒæ‰‹æœº</button>

        <div class="prompt">
            <h3>éªŒè¯æ‚¨ä¸æ˜¯æœºå™¨äººğŸ¤–</h3>
            <p>å€¾æ–œæ‰‹æœºå·¦å³ç§»åŠ¨æ»‘å—è¿›è¡ŒéªŒè¯</p>
        </div>

        <div class="target-area">
            <div class="label">ç›®æ ‡ä½ç½®</div>
            <div class="value" id="targetValue">0.000</div>
            <div class="target-tip">å°†æ»‘å—ç§»åŠ¨åˆ°æ­¤ä½ç½®å¹¶ä¿æŒ3ç§’</div>
            <div class="target-marker" id="targetMarker"></div>
        </div>

        <div class="slider-container" id="sliderContainer">
            <div class="arrow-icon left-arrow">â†</div>
            <div class="slider-track"></div>
            <div class="slider-handle" id="sliderHandle"></div>
            <div class="arrow-icon right-arrow">â†’</div>
        </div>

        <div class="scale-ruler">
            <span>0.000</span>
            <span>0.250</span>
            <span>0.500</span>
            <span>0.750</span>
            <span>1.000</span>
        </div>

        <div class="current-position-box">
            <span class="label">å½“å‰ä½ç½®:</span>
            <div class="current-position-value" id="currentValue">0.000</div>
        </div>
        
        <div class="message" id="verificationMessage">è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆæƒ</div>
    </div>

    <div class="nav-bar">
        <span>&#x2329;</span>
        <span>&gt;</span>
        <span>&#x2302;</span>
        <span>&#x25A1;</span>
        <span>&#x2642;</span>
    </div>

    <script>
        const sliderContainer = document.getElementById('sliderContainer');
        const sliderHandle = document.getElementById('sliderHandle');
        const currentValueDisplay = document.getElementById('currentValue');
        const targetValueDisplay = document.getElementById('targetValue');
        const targetMarker = document.getElementById('targetMarker');
        const verificationMessage = document.getElementById('verificationMessage');
        const permissionButton = document.getElementById('permissionButton');

        let containerWidth = sliderContainer.clientWidth;
        let currentValue = 0.500;
        let targetValue = 0.000;
        let timer = null;
        
        // å®¹é”™èŒƒå›´ (Tolerance)ï¼šå…è®¸çš„è¯¯å·® (Â±0.02)ã€‚å½“å‰å€¼åœ¨ [ç›®æ ‡å€¼ - 0.02, ç›®æ ‡å€¼ + 0.02] å†…å³å¯é€šè¿‡éªŒè¯ã€‚
        const TARGET_TOLERANCE = 0.02; 
        const HOLD_DURATION = 3000; 

        // çµæ•åº¦ï¼šæ‰‹æœºæœ€å¤§å€¾æ–œè§’åº¦é™åˆ¶ï¼Œå½“å‰è®¾ç½®ä¸º 45 åº¦ã€‚å€¼è¶Šå°è¶Šçµæ•ã€‚
        const MAX_TILT_ANGLE = 45; 
        const TILT_RANGE = 2 * MAX_TILT_ANGLE; // 90åº¦ (45 - (-45))

        let sensorActive = false;
        
        // æ ¸å¿ƒï¼šé€šè¿‡æ‰‹æœºå€¾æ–œè§’åº¦ (gamma) æ˜ å°„åˆ° 0 åˆ° 1 çš„ä½ç½®
        function mapAngleToPosition(gamma) {
            // 1. é™åˆ¶ gamma è§’åœ¨æ›´å°çš„èŒƒå›´ï¼Œè§£å†³â€œåˆ°å¤´åç»§ç»­å€¾æ–œæ„Ÿè§‰åˆå¾ªç¯â€çš„é—®é¢˜ã€‚
            gamma = Math.max(-MAX_TILT_ANGLE, Math.min(MAX_TILT_ANGLE, gamma));
            
            // 2. æ˜ å°„é€»è¾‘ï¼šå°† (-MAX_TILT_ANGLE) åˆ° (MAX_TILT_ANGLE) æ˜ å°„åˆ° 0 åˆ° 1
            let position = (gamma + MAX_TILT_ANGLE) / TILT_RANGE;
            
            // 3. æœ€ç»ˆä¿é™©ï¼šç¡®ä¿ç»“æœåœ¨ 0 åˆ° 1 èŒƒå›´å†…
            return Math.max(0, Math.min(1, position)); 
        }

        // 1. åˆå§‹åŒ– - éšæœºç”Ÿæˆç›®æ ‡ä½ç½®
        function initializeTarget() {
            // ç¡®ä¿ç›®æ ‡å€¼åœ¨ 0.1 åˆ° 0.9 ä¹‹é—´ï¼Œé¿å…è¾¹ç¼˜
            targetValue = (Math.random() * 0.8 + 0.1).toFixed(3);
            targetValue = parseFloat(targetValue);
            targetValueDisplay.textContent = targetValue.toFixed(3);
            
            containerWidth = sliderContainer.clientWidth; 
            const targetPosition = targetValue * containerWidth;
            targetMarker.style.left = targetPosition + 'px';
            
            // é‡ç½®æ»‘å—ä½ç½®å’ŒçŠ¶æ€
            currentValue = 0.500; // åˆå§‹è®¾ä¸ºä¸­é—´
            updateHandlePosition(currentValue * containerWidth); 
            verificationMessage.textContent = sensorActive ? 'è¯·æ‘‡æ™ƒæ‰‹æœºç§»åŠ¨æ»‘å—' : 'è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆæƒ';
            verificationMessage.className = 'message';
            clearTimeout(timer);
        }

        // 2. æ›´æ–°æ»‘å—ä½ç½®å’Œå½“å‰å€¼
        function updateHandlePosition(newX) {
            let x = Math.max(0, Math.min(containerWidth, newX));
            
            sliderHandle.style.left = x + 'px';
            
            currentValue = (x / containerWidth);
            currentValueDisplay.textContent = currentValue.toFixed(3);
            
            if (sensorActive) {
                checkVerificationStatus();
            }
        }

        // 3. éªŒè¯é€»è¾‘
        function checkVerificationStatus() {
            const diff = Math.abs(currentValue - targetValue);
            
            // ä½¿ç”¨ TARGET_TOLERANCE è¿›è¡ŒèŒƒå›´æ£€æŸ¥
            if (diff <= TARGET_TOLERANCE) {
                sliderHandle.style.backgroundColor = '#4CAF50'; 
                if (!timer) {
                    verificationMessage.textContent = 'ä½ç½®æ¥è¿‘ï¼Œè¯·ä¿æŒ...';
                    timer = setTimeout(() => {
                        if (Math.abs(currentValue - targetValue) <= TARGET_TOLERANCE) {
                            verificationSuccess();
                        } else {
                            resetTimerAndStatus('è¯·ä¿æŒç¨³å®š');
                        }
                    }, HOLD_DURATION);
                }
            } else {
                sliderHandle.style.backgroundColor = '#4a90e2';
                if (timer) {
                    resetTimerAndStatus('ä½ç½®åå·®è¿‡å¤§');
                }
            }
        }

        function resetTimerAndStatus(message) {
            clearTimeout(timer);
            timer = null;
            if (message) {
                verificationMessage.textContent = message;
                verificationMessage.className = 'message error';
            } else {
                verificationMessage.textContent = sensorActive ? 'è¯·æ‘‡æ™ƒæ‰‹æœºç§»åŠ¨æ»‘å—' : 'è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆæƒ';
                verificationMessage.className = 'message';
            }
        }

        function verificationSuccess() {
            clearTimeout(timer);
            sensorActive = false; 
            window.removeEventListener('deviceorientation', handleDeviceOrientation);

            sliderHandle.style.backgroundColor = '#4CAF50';
            verificationMessage.textContent = 'âœ… éªŒè¯æˆåŠŸï¼åˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹';
            verificationMessage.className = 'message success';
            permissionButton.disabled = true;
            permissionButton.textContent = 'å·²å®ŒæˆéªŒè¯';
        }
        
        // 4. é™€èºä»ª/æ–¹å‘ä¼ æ„Ÿå™¨å¤„ç†å‡½æ•°
        function handleDeviceOrientation(event) {
            if (!sensorActive) return;
            
            // gamma æ˜¯è®¾å¤‡åœ¨ Z è½´ä¸Šçš„æ—‹è½¬è§’ï¼Œä»£è¡¨å·¦å³å€¾æ–œ
            const gamma = event.gamma; 
            
            if (gamma !== null) {
                const mappedPosition = mapAngleToPosition(gamma);
                const newX = mappedPosition * containerWidth;
                updateHandlePosition(newX);
            }
        }
        
        // 5. æƒé™è¯·æ±‚å’Œå¯åŠ¨ä¼ æ„Ÿå™¨
        function requestSensorPermission() {
            permissionButton.disabled = true;
            
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒ iOS 13+ çš„æƒé™è¯·æ±‚ API
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startSensorListening();
                        } else {
                            permissionButton.disabled = false;
                            permissionButton.textContent = 'æˆæƒå¤±è´¥ï¼Œè¯·é‡è¯•';
                            verificationMessage.textContent = 'éœ€è¦è®¾å¤‡è¿åŠ¨æƒé™æ‰èƒ½ä½¿ç”¨æ‘‡æ™ƒåŠŸèƒ½';
                            verificationMessage.className = 'message error';
                        }
                    })
                    .catch(error => {
                        // å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚ä¸æ˜¯ HTTPS
                        permissionButton.disabled = false;
                        permissionButton.textContent = 'æˆæƒå¤±è´¥ï¼Œè¯·é‡è¯•';
                        verificationMessage.textContent = 'æˆæƒè¯·æ±‚å¤±è´¥ (' + error.message + ')ã€‚è¯·ç¡®ä¿ä½¿ç”¨HTTPSæˆ–æœ¬åœ°ç¯å¢ƒã€‚';
                        verificationMessage.className = 'message error';
                    });
            } else {
                // é iOS 13+ è®¾å¤‡æˆ–æ—§ç‰ˆ Android (é€šå¸¸é»˜è®¤å…è®¸)
                startSensorListening();
            }
        }

        function startSensorListening() {
            sensorActive = true;
            permissionButton.textContent = 'å·²æˆæƒ (æ‘‡æ™ƒæ‰‹æœº)';
            
            window.addEventListener('deviceorientation', handleDeviceOrientation);
            
            verificationMessage.textContent = 'è¯·æ‘‡æ™ƒæ‰‹æœºç§»åŠ¨æ»‘å—';
            verificationMessage.className = 'message';
        }

        // 6. äº‹ä»¶ç»‘å®šå’Œåˆå§‹åŒ–
        permissionButton.addEventListener('click', requestSensorPermission);
        
        // å±å¹•å¤§å°å˜åŒ–æ—¶é‡æ–°åˆå§‹åŒ–UIä½ç½®
        window.addEventListener('resize', () => {
            containerWidth = sliderContainer.clientWidth; 
            updateHandlePosition(currentValue * containerWidth);
            const targetPosition = targetValue * containerWidth;
            targetMarker.style.left = targetPosition + 'px';
        });

        // é¦–æ¬¡åŠ è½½
        initializeTarget();
        
        // åˆå§‹æ£€æŸ¥æ˜¯å¦éœ€è¦æŒ‰é’®ï¼ˆä»…æ”¯æŒé™€èºä»ª API çš„æµè§ˆå™¨æ‰æ˜¾ç¤ºæŒ‰é’®ï¼Œå¦åˆ™é»˜è®¤å¯åŠ¨ï¼‰
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission !== 'function') {
            // Android æˆ–æ—§ç‰ˆæµè§ˆå™¨ï¼Œé»˜è®¤ç›´æ¥å¯åŠ¨ä¼ æ„Ÿå™¨
            permissionButton.style.display = 'none';
            startSensorListening();
        } else if (typeof DeviceOrientationEvent === 'undefined') {
             // ä¸æ”¯æŒä¼ æ„Ÿå™¨
            permissionButton.disabled = true;
            permissionButton.textContent = 'è®¾å¤‡ä¸æ”¯æŒè¿åŠ¨ä¼ æ„Ÿå™¨';
            verificationMessage.textContent = 'æ‚¨çš„è®¾å¤‡/æµè§ˆå™¨ä¸æ”¯æŒè¿åŠ¨ä¼ æ„Ÿå™¨åŠŸèƒ½';
            verificationMessage.className = 'message error';
        }
    </script>

</body>
</html>
